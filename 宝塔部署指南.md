# 宝塔面板部署指南

## 服务器信息
- 服务器IP: 60.205.195.58
- 面板类型: 宝塔Linux面板

## 部署步骤

### 第一步：本地构建项目

在本地项目目录执行：

```bash
# 安装依赖（如果还没安装）
npm install

# 构建生产版本
npm run build
```

构建完成后，会在项目根目录生成 `dist` 文件夹，这就是需要上传到服务器的文件。

---

### 第二步：登录宝塔面板

1. 浏览器访问：`http://60.205.195.58:8888`
2. 输入宝塔面板的用户名和密码登录

---

### 第三步：创建网站

#### 3.1 添加站点
1. 点击左侧菜单 **"网站"**
2. 点击 **"添加站点"** 按钮
3. 填写配置：
   - **域名**：填写你的域名（如 `blog.example.com`）或直接用IP `60.205.195.58`
   - **根目录**：选择或创建目录，如 `/www/wwwroot/hailin-blog`
   - **FTP**：不创建
   - **数据库**：不创建（前端项目不需要）
   - **PHP版本**：选择 "纯静态"
4. 点击 **"提交"**

#### 3.2 配置站点
创建完成后，点击站点右侧的 **"设置"** 按钮：

1. **网站目录**：
   - 确认网站目录为：`/www/wwwroot/hailin-blog`
   - 运行目录：选择 `/`（根目录）
   - 勾选 **"防跨站攻击"**

2. **默认文档**：
   - 确保 `index.html` 在列表中且排在第一位

---

### 第四步：上传项目文件

#### 方法一：使用宝塔文件管理器（推荐）

1. 在宝塔面板点击左侧 **"文件"**
2. 进入网站目录：`/www/wwwroot/hailin-blog`
3. 点击 **"上传"** 按钮
4. 将本地 `dist` 文件夹内的所有文件上传（注意：是 dist 文件夹**里面**的文件，不是 dist 文件夹本身）
5. 上传完成后，目录结构应该是：
   ```
   /www/wwwroot/hailin-blog/
   ├── index.html
   ├── assets/
   │   ├── index-xxx.js
   │   └── index-xxx.css
   └── public/
       └── ...
   ```

#### 方法二：使用FTP工具

1. 在宝塔面板创建FTP账号
2. 使用 FileZilla 等FTP工具连接服务器
3. 上传 `dist` 文件夹内的所有文件到 `/www/wwwroot/hailin-blog`

---

### 第五步：配置 Nginx（重要）

由于这是 Vue Router 的单页应用，需要配置 Nginx 重定向规则：

1. 在网站设置中，点击 **"配置文件"** 标签
2. 找到 `location / { ... }` 部分
3. 修改为：

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

完整的 location 配置示例：

```nginx
location / {
    try_files $uri $uri/ /index.html;
    index index.html index.htm;
}
```

4. 点击 **"保存"** 按钮
5. 重启 Nginx（宝塔会自动提示）

---

### 第六步：配置防火墙和安全组

#### 6.1 宝塔防火墙
1. 点击左侧 **"安全"**
2. 确保开放以下端口：
   - `80` (HTTP)
   - `443` (HTTPS，如果需要SSL)
   - `8888` (宝塔面板)

#### 6.2 云服务器安全组
登录你的云服务器控制台（阿里云/腾讯云等），配置安全组规则：
- 开放 `80` 端口（HTTP）
- 开放 `443` 端口（HTTPS）

---

### 第七步：访问网站

1. 浏览器访问：`http://60.205.195.58`
2. 如果配置了域名，访问：`http://你的域名.com`

---

## 可选配置

### 配置 SSL 证书（HTTPS）

1. 在网站设置中，点击 **"SSL"** 标签
2. 选择以下方式之一：
   - **Let's Encrypt**：免费证书，自动续期
   - **其他证书**：上传你购买的SSL证书
3. 部署证书后，开启 **"强制HTTPS"**

### 配置域名

1. 在域名服务商处添加 A 记录：
   - 主机记录：`@` 或 `www`
   - 记录类型：`A`
   - 记录值：`60.205.195.58`
   - TTL：`600`
2. 等待DNS解析生效（通常5-10分钟）
3. 在宝塔面板网站设置中添加域名

---

## 常见问题

### 1. 页面刷新后出现 404
**原因**：Nginx 没有配置 Vue Router 的重定向规则
**解决**：按照第五步配置 `try_files $uri $uri/ /index.html;`

### 2. 静态资源加载失败
**原因**：文件路径不正确
**解决**：
- 检查 `vite.config.js` 中的 `base` 配置
- 如果部署在子目录，需要设置 `base: '/子目录名/'`

### 3. 视频/音频无法播放
**原因**：文件太大或格式不支持
**解决**：
- 确保 `public` 目录下的媒体文件已上传
- 检查 Nginx 上传文件大小限制（默认1M）
- 在网站设置 → 配置文件中添加：
  ```nginx
  client_max_body_size 100M;
  ```

### 4. 网站访问慢
**解决方案**：
- 开启 Gzip 压缩（宝塔面板 → 网站设置 → 配置文件）
- 配置浏览器缓存
- 使用 CDN 加速

---

## 更新网站

当需要更新网站内容时：

1. 本地修改代码
2. 执行 `npm run build` 重新构建
3. 删除服务器上的旧文件（保留 `public` 目录中的媒体文件）
4. 上传新的 `dist` 文件夹内容
5. 清除浏览器缓存后访问

---

## Nginx 完整配置参考

```nginx
server {
    listen 80;
    server_name 60.205.195.58;  # 或你的域名
    
    root /www/wwwroot/hailin-blog;
    index index.html;
    
    # 开启 Gzip 压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    
    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|mp4|mp3)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
    
    # Vue Router 配置
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 上传文件大小限制
    client_max_body_size 100M;
}
```

---

## 快速命令参考

```bash
# 本地构建
npm run build

# 查看构建结果
ls dist/

# 测试构建结果（可选）
npm run preview
```

---

## 联系支持

如果遇到问题：
1. 查看宝塔面板的错误日志（网站设置 → 日志）
2. 查看 Nginx 错误日志：`/www/wwwroot/logs/nginx_error.log`
3. 检查浏览器控制台的错误信息

---

**部署完成后，你的博客就可以通过 http://60.205.195.58 访问了！** 🎉
